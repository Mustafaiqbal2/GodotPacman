name: Export iOS

on:
  workflow_dispatch:  # Manual trigger
  push:
    branches: [ main ]  # Optional: Trigger on pushes to main

jobs:
  export:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          lfs: true  # Add this if you use Git LFS
        
      - name: Install Godot
        run: |
          brew install --cask godot
          
      - name: Export iOS project
        run: |
          mkdir -p build/ios
          godot --headless --export "iOS" "build/ios/GodotPacman.xcarchive" --export-debug
          
      - name: Create IPA structure 
        run: |
          cd build/ios
          mkdir -p Payload
          cp -r GodotPacman.xcarchive/Products/Applications/GodotPacman.app Payload/
          zip -r GodotPacman.zip Payload
          mv GodotPacman.zip GodotPacman.ipa
          
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: ios-build
          path: |
            build/ios/GodotPacman.xcarchive
            build/ios/GodotPacman.ipa
